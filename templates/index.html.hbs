<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Bank Account Tracker</title>

    <link rel="stylesheet" href="styles.css">
	<script type="text/javascript" src="script.js" defer></script>
</head>

<body>
<div class="dual">
	<div id="history">
		<div id="last-day" class="box">
		    <h1>Last 24h overview</h1>
	        <table class="last-day-list">
			<tbody>
				{{#if usersDelta.length}}
		          	{{#each usersDelta~}}
			        	<tr>
							<td class="user">{{this.name}}</td>
							<td class="delta{{#if (isAmountNegative this.delta)}} negative{{/if}}">{{#unless (isAmountNegative this.delta)}}+{{/unless}}{{formatBalance this.delta}}</td>
						</tr>
		          	{{~/each}}
				{{else}}
					<p class="user">No recent activity. Spend money and come back.</p>
				{{/if}}
				</tbody>
	        </table>
		</div>

	    <div id="transaction-history" class="box">
	        <h1>Transactions history</h1>
	        <table class="history-list">
			<tbody>
	          {{#each operations~}}
		        <tr>
					<td class="action{{#if (isDeposit this)}} deposit {{else if (isWithdrawal this)}} withdrawal {{else if (isPlayerTransfer this)}} transfer{{/if}}">{{#if (isDeposit this)}}+ {{else if (isWithdrawal this)}} - {{else if (isPlayerTransfer this)}} â¬Œ {{/if}}</td>
					<td class="amount{{#if (isAmountImportant this.amount)}} large{{/if}}">{{formatBalance (absolute this.amount)}}</td>
					<td class="user">{{#if (isPlayerTransfer this)}} {{this.sender}} ðŸ¡’ {{/if}}</td>
					<td class="user">{{this.username}}</td>
					<td>{{formatTimestamp this.timestamp}}</td>
					<td>{{#if (isStackedTransaction this.number)}} (x{{this.number}}) {{else}} {{/if}}</td>
				</tr>
	          {{~/each}}
			</tbody>
	        </table>
			<p class="number-of-transactions">Shown {{operations.length}} transactions on {{totalNumberOfOperations}} recorded</p>
	    </div>
	</div>
	<div id="additional-info">
	    <div id="balance" class="box">
	        <p class="balance-info">Balance: {{formatBalance balance}} ({{computePercentage balance maxBalance}}%)</p>
			<p class="balance-info additional">Max balance: {{formatBalance maxBalance}}</p>

			<p class="balance-info">Interests: {{ formatBalance bankInterests }}</p>
			
			<div class="members">
		        <h2>Members</h2>

		        <table>
				<tbody>
		          {{#each users~}}
		            <tr data-username="{{this.name}}">
						<td class="user">{{this.name}}</td>
						<td class="common-balance{{#if (isAmountNegative this.commonBalance)}} negative{{/if}}">{{formatBalance this.commonBalance}}</td>
					</tr>
		          {{~/each}}
				</tbody>
		        </table>
			</div>
	    </div>

		<div id="actions" class="box">
            <h1>Transfer</h1>
            <form id="transaction-form">
                <datalist id="users-list">
                  {{#each users~}}
		            <option value="{{this.name}}">{{this.name}}</option>
		          {{~/each}}
		            <option value="@bank-interest">Bank Interests</option>
                </datalist>

				<div>
	                <label for="amount">Amount:</label>
	                <input type="number" id="amount" name="amount" required>
				</div>

				<div>
	                <label for="from-user">From:</label>
	                <input type="text" list="users-list" id="from-user" name="from-user" required>
				</div>

				<div>
	                <label for="to-user">To:</label>
	                <input type="text" list="users-list" id="to-user" name="to-user" required>
				</div>

                <button id="transfer">Transfer</button>
            </form>
            <span id="transfer-logs"></span>
        </div>

	    <div id="technical-infos" class="box">
	        <h1>Technical informations</h1>
			<p>Last check: {{formatTimestamp lastCheckTimestamp}}</p>
			<p>Last transaction: {{formatTimestamp lastTransactionTimestamp}}</p>
			<p id="drift">Drift: <span {{#if (isDriftImportant drift)}}class="important"{{/if}}>{{drift}}</span></p>
			<p id="websocket-info">WS: <span>connecting</span></p>
			<button id="reload" action="submit">Reload</button>
	    </div>
    </div>
</div>
</body>
</html>
